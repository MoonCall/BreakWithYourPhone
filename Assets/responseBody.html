<html>
	<head>
	<title> Test on Accelarometer </title>
	</head>



	<body>
        <button onclick="connectInputServer()"> Connect Input Server </button> <br>
        <button onclick="calibrate()"> Calibrate </button> <br>
	    x: <p id="x"></p>
	    y: <p id="y"></p>
	    z: <p id="z"></p>
	    alpha: <p id="alpha"></p>
	    beta: <p id="beta"></p>
	    gamma: <p id="gamma"></p>
	    alpha_o: <p id="alpha_o"></p>
	    beta_o: <p id="beta_o"></p>
	    gamma_o: <p id="gamma_o"></p>
	</body>

    <script>
        var aX;
        var aY;
        var aZ;
        var aAlphaO;
        var aBetaO;
        var aGammaO;

	    function accelerometerUpdate(e) {
		    aX = event.acceleration.x;
		    aY = event.acceleration.y;
		    aZ = event.acceleration.z;

		    var aAlpha = event.rotationRate.alpha*1;
		    var aBeta = event.rotationRate.beta*1;
		    var aGamma = event.rotationRate.gamma*1;
		    //The following two lines are just to calculate a
		    // tilt. Not really needed.

		    //xPosition = Math.atan2(aY, aZ);
		    //yPosition = Math.atan2(aX, aZ);

		    document.getElementById("x").innerHTML = aX;
		    document.getElementById("y").innerHTML = aY;
		    document.getElementById("z").innerHTML = aZ;

		    document.getElementById("alpha").innerHTML = aAlpha;
		    document.getElementById("beta").innerHTML = aBeta;
		    document.getElementById("gamma").innerHTML = aGamma;
	    }

	    function directionUpdate(e) {
		    aAlphaO = event.alpha;
		    aBetaO = event.beta;
		    aGammaO = event.gamma;

		    document.getElementById("alpha_o").innerHTML = aAlphaO;
		    document.getElementById("beta_o").innerHTML = aBetaO;
		    document.getElementById("gamma_o").innerHTML = aGammaO;
	    }

	    var socketOpen = false;
	    var ws;
	    var calibrated = false;
	    function calibrate() {
	        if (window.DeviceMotionEvent == undefined) {
	            //No accelerometer is present. Use buttons.
	            alert("no accelerometer exists");
	        }
	        else if (!calibrated && socketOpen) {
	            window.addEventListener("devicemotion", accelerometerUpdate, true);
	            window.addEventListener("deviceorientation", directionUpdate, true);
	            setTimeout(function () {
	                calibrated = true;
	                ws.send("calibrate");
	            }, 1000);
	        }
	    }

	    function updateSensorInfo () {
	        setTimeout(function () {
	            if (calibrated) {
	                if (aX != null && aY != null && aZ != null && aAlphaO != null && aBetaO != null && aGammaO != null) {
	                    ws.send(aX + "," + aY + "," + aZ + "," + aAlphaO + "," + aBetaO + "," + aGammaO);
	                    updateSensorInfo();
	                }
	                else {
	                    alert("Your device does not support devicemotion (which provide sensor information)")
	                    ws.close();
	                }
	            }
	            else {
	                updateSensorInfo();
	            }
	        }, 50);
	    }
	    
	    function connectInputServer() {
	        if ("WebSocket" in window && !socketOpen) {
	            var ip = "REPLACE_THIS_IP_ADDR";
	            var port = "REPLACE_THIS_PORT";
	            ws = new WebSocket("ws://" + ip + ":" + port + "/ProcessSensorInfo");
	            socketOpen = true;
	            ws.onopen = updateSensorInfo;
	            ws.onclose = function () {
	                alert("Input Server Connection Closed");
	                socketOpen = false;
	            };
	        }
	        else if (!socketOpen) {
	            alert("WebSocket is not supported in your browser!");
	        }
	    }
    </script>
</html>


